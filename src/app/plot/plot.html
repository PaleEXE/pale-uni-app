<div class="flex flex-col justify-center items-center h-full">
  <div class="flex justify-center items-center h-6 mb-8 mt-6">
    <h1 class="text-3xl font-bold text-primary-700">Plot</h1>
  </div>
  <div class="flex">
    <div
      class="flex flex-col gap-6 m-6 w-64 p-6 bg-primary-100 border border-primary-300 rounded-lg shadow"
    >
      <select
        id="algorithm"
        class="w-48 px-3 py-2 text-box bg-primary-400 text-white cursor-pointer hover:bg-primary-500"
        [value]="selectedAlgorithm()"
        (change)="selectedAlgorithm.set($any($event.target).value)"
      >
        <option value="kmeans">K-Means</option>
        <option value="Agglomerative">Agglomerative</option>
        <option value="DBSCAN">DBSCAN</option>
      </select>

      <!-- K-Means/Agglomerative Controls -->
      @if (selectedAlgorithm() !== 'DBSCAN') {
        <div>
          <label for="clusterCount" class="font-medium mb-2 block"
            >Number of Clusters:
          </label>
          <div class="flex items-center space-x-4">
            <input
              id="clusterCount"
              type="range"
              min="1"
              max="10"
              step="1"
              [value]="clusterCount()"
              (input)="clusterCount.set($any($event.target).valueAsNumber)"
              class="slider"
            />
            <span
              class="h-8 w-10 flex items-center justify-center text-center rounded-md bg-white/80 text-primary-700 font-semibold text-sm shadow-sm border border-primary-300"
              >{{ clusterCount() }}</span
            >
          </div>
        </div>
      }

      <!-- DBSCAN Controls -->
      @if (selectedAlgorithm() === 'DBSCAN') {
        <div class="space-y-4">
          <div>
            <div class="flex items-center gap-2 mb-2">
              <label for="eps" class="font-medium flex">Epsilon (eps):</label>
              <button 
                (click)="showBorder.set(!showBorder())"
                class="p-1 rounded hover:bg-primary-200 transition-colors"
                [class.text-primary-600]="showBorder()"
                [class.text-primary-400]="!showBorder()"
                [attr.title]="showBorder() ? 'Hide borders' : 'Show borders'"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M12 16a4 4 0 100-8 4 4 0 000 8z" />
                </svg>
              </button>
            </div>
            <div class="flex items-center space-x-4">
              <input
                id="eps"
                type="range"
                min="0.1"
                max="30.0"
                step="0.1"
                [value]="eps()"
                (input)="eps.set($any($event.target).valueAsNumber)"
                class="slider"
              />
              <span
                class="h-8 w-10 flex items-center justify-center text-center rounded-md bg-white/80 text-primary-700 font-semibold text-sm shadow-sm border border-primary-300"
                >{{ eps().toFixed(1) }}</span
              >
            </div>
          </div>

          <div>
            <label for="minSamples" class="font-medium mb-2 block"
              >Minimum Samples:
            </label>
            <div class="flex items-center space-x-4">
              <input
                id="minSamples"
                type="range"
                min="1"
                max="20"
                step="1"
                [value]="minSamples()"
                (input)="minSamples.set($any($event.target).valueAsNumber)"
                class="slider"
              />
              <span
                class="h-8 w-10 flex items-center justify-center text-center rounded-md bg-white/80 text-primary-700 font-semibold text-sm shadow-sm border border-primary-300"
                >{{ minSamples() }}</span
              >
            </div>
          </div>
        </div>
      }

      <!-- Point Size Slider -->
      <div>
        <label for="pointSize" class="font-medium mb-2 block"
          >Point Size:
        </label>
        <div class="flex items-center space-x-4">
          <input
            id="pointSize"
            type="range"
            min="4"
            max="20"
            step="1"
            [value]="pointSize()"
            (input)="pointSize.set($any($event.target).valueAsNumber)"
            class="slider"
          />
          <span
            class="h-8 w-10 flex items-center justify-center text-center rounded-md bg-white/80 text-primary-700 font-semibold text-sm shadow-sm border border-primary-300"
            >{{ pointSize() }}</span
          >
        </div>
      </div>

      <button class="pale-button h-12" (click)="performClustering()">
        Cluster
      </button>
      <button
        class="pale-button h-12"
        [class.bg-red-600]="deleteMode()"
        (click)="toggleDeleteMode()"
      >
        {{ deleteMode() ? 'Cancel Delete' : 'Delete Points' }}
      </button>
      <button class="pale-button h-12" (click)="reset()">Reset</button>
    </div>

    <div
      #plotArea
      class="relative w-142 h-142 border-2 border-primary-500 bg-primary-50 rounded-lg z-10 overflow-hidden shadow"
      [class.border-primary-500]="!deleteMode()"
      [class.border-red-500]="deleteMode()"
      [class.cursor-crosshair]="deleteMode()"
      (mousedown)="onPlotMouseDown($event)"
      (click)="onPlotClick($event)"
      (mouseup)="onPlotMouseUp()"
      (mouseleave)="onPlotMouseUp()"
      (mousemove)="onPlotMouseMove($event)"
    >
      <!-- Y-Axis (Vertical line in center) -->
      <div
        class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-primary-300 -translate-x-1/2"
      ></div>

      <!-- X-Axis (Horizontal line in center) -->
      <div
        class="absolute top-1/2 left-0 right-0 h-0.5 bg-primary-300 -translate-y-1/2"
      ></div>

      <!-- Points -->
      @for (point of points(); track $index) {
        <div
          class="absolute rounded-full"
          [style.left.px]="getPointPosition(point).x"
          [style.top.px]="getPointPosition(point).y"
          [style.width.px]="pointSize()"
          [style.height.px]="pointSize()"
          [class]="getPointColor($index)"
        ></div>
        @if (selectedAlgorithm() === 'DBSCAN' && showBorder()) {
          <div
            class="point absolute rounded-full opacity-1"
            [style.left.px]="getPointBorderPosition(point).x"
            [style.top.px]="getPointBorderPosition(point).y"
            [style.width.px]="borderSize()"
            [style.height.px]="borderSize()"
            [class]="getPointColor($index)"
          ></div>
        }
      }

      <!-- Centroids -->
      @for (centroid of centroids(); track $index) {
        <div
          class="absolute rounded-full border-2 border-white"
          [style.left.px]="getPointPosition(centroid).x - pointSize() / 2"
          [style.top.px]="getPointPosition(centroid).y - pointSize() / 2"
          [style.width.px]="pointSize() * 2"
          [style.height.px]="pointSize() * 2"
          [class]="getCentroidColor($index)"
        ></div>
      }
    </div>
  </div>
</div>