<div class="flex flex-col justify-start items-center h-screen">
  <!-- Header -->
  <div class="flex justify-center items-center h-16 mb-4 mt-4 w-full">
    <h1 class="text-3xl font-bold text-primary-700">Logic Evaluator</h1>
  </div>

  <!-- Main Grid Container -->
  <div
    class="grid grid-cols-[320px_1fr] gap-6 w-full h-[calc(100vh-120px)] px-6 pb-6"
  >
    <!-- Sidebar Controls -->
    <div
      class="flex flex-col gap-6 p-6 bg-primary-100 border border-primary-300 rounded-lg shadow overflow-y-auto h-full"
    >
      <!-- Main Expression Input -->
      <div
        class="space-y-2 sticky top-0 bg-primary-100 pb-3 -mx-6 mb-4 -mt-6 px-6 border-b border-primary-300 z-10"
      >
        <label
          for="expression"
          class="text-sm font-medium block text-primary-700"
          >Expression:</label
        >
        <input
          type="text"
          id="expression"
          class="w-full px-3 py-2 text-box bg-primary-400 text-white rounded"
          placeholder="e.g., a&b|c"
          (keydown.enter)="onEvaluate(expressionInput)"
          #expressionInput
        />
      </div>

      <!-- Evaluate Section -->
      <div class="space-y-3">
        <h3 class="font-semibold text-primary-700">Evaluate</h3>
        <button
          class="pale-button w-full"
          (click)="onEvaluate(expressionInput)"
        >
          Evaluate
        </button>
      </div>

      <!-- Divider -->
      <div class="border-t border-primary-300"></div>

      <!-- Is Equivalent Section -->
      <div class="space-y-3">
        <h3 class="font-semibold text-primary-700">Check Equivalence</h3>
        <div>
          <label
            for="expr1"
            class="text-sm font-medium mb-2 block text-primary-700"
            >Compare with:</label
          >
          <input
            type="text"
            id="expr1"
            class="w-full px-3 py-2 text-box bg-primary-400 text-white rounded"
            placeholder="e.g., b&a"
            (keydown.enter)="onIsEquivalent(expressionInput, expr2Input)"
            #expr2Input
          />
        </div>
        <button
          class="pale-button w-full"
          (click)="onIsEquivalent(expressionInput, expr2Input)"
        >
          Check Equivalence
        </button>
      </div>

      <!-- Divider -->
      <div class="border-t border-primary-300"></div>

      <!-- Where Section -->
      <div class="space-y-3">
        <h3 class="font-semibold text-primary-700">Filter by Conditions</h3>
        @if (conditionVars().length > 0) {
        <div
          class="bg-white/80 p-3 rounded border border-primary-300 shadow-sm"
        >
          <div class="grid grid-cols-2 gap-2">
            @for (condition of conditionVars(); track $index; let i = $index) {
            <button
              (click)="toggleConditionValue(i)"
              [ngClass]="{
                'font-bold py-2 px-3 rounded text-sm transition-all flex items-center justify-center gap-1 cursor-pointer': true,
                'bg-primary-300 hover:bg-primary-400 text-primary-800': condition.value === '?',
                'bg-primary-500 hover:bg-primary-600 text-white': condition.value === 1,
                'bg-primary-700 hover:bg-primary-800 text-white': condition.value === 0
              }"
              [title]="condition.value === '?' ? 'Ignore' : (condition.value === 1 ? 'True' : 'False')"
            >
              <span>{{ condition.name }}</span>
              <span class="text-xs">
                {{ condition.value === '?' ? '?' : (condition.value === 1 ? '1'
                : '0') }}
              </span>
            </button>
            }
          </div>
        </div>
        <div class="bg-primary-50 p-2 rounded border border-primary-200">
          <p class="text-xs text-primary-700 font-medium">
            Click to toggle:
            <span
              class="inline-block bg-primary-300 text-primary-800 px-2 py-0.5 rounded font-bold"
              >?</span
            >
            →
            <span
              class="inline-block bg-primary-500 text-white px-2 py-0.5 rounded font-bold"
              >1</span
            >
            →
            <span
              class="inline-block bg-primary-700 text-white px-2 py-0.5 rounded font-bold"
              >0</span
            >
          </p>
        </div>
        } @else {
        <div
          class="bg-white/80 p-4 rounded border border-primary-300 shadow-sm"
        >
          <p class="text-sm text-primary-600 text-center">
            Evaluate an expression first to set conditions
          </p>
        </div>
        }
      </div>
    </div>

    <!-- Results Area -->
    <div
      class="flex flex-col gap-4 p-6 bg-primary-50 border border-primary-300 rounded-lg shadow overflow-y-auto"
    >
      <!-- Error Message -->
      @if (errMsg() !== '') {
      <div
        class="p-4 bg-primary-200 border-2 border-primary-400 text-primary-700 rounded-lg font-semibold flex-shrink-0"
      >
        {{ errMsg() }}
      </div>
      }

      <!-- Equivalence Result -->
      @if (equivalentResult() !== null) {
      <div
        class="p-4 rounded-lg font-semibold flex-shrink-0 border-2"
        [ngClass]="equivalentResult() ? 'bg-primary-100 text-primary-700 border-primary-400' : 'bg-primary-200 text-primary-700 border-primary-400'"
      >
        {{ equivalentResult() ? '✓ Expressions are equivalent' : '✗ Expressions
        are NOT equivalent' }}
      </div>
      }

      <!-- Results Table -->
      @if (headers().length > 0) {
      <div class="overflow-auto flex-1 border border-primary-300 rounded-lg">
        <table class="w-full border-collapse">
          <thead class="sticky top-0">
            <tr class="bg-primary-200 border-b-2 border-primary-400">
              @for (header of headers(); track $index) {
              <th
                class="text-primary-700 font-bold text-sm px-6 py-3 tracking-wider border border-primary-300 whitespace-nowrap"
              >
                {{ header }}
              </th>
              }
            </tr>
          </thead>
          <tbody class="bg-primary-100">
            @for (row of data(); track $index) {
            <tr class="border-b border-primary-200 hover:bg-primary-200">
              @for (value of row; track $index) {
              <td
                class="px-6 py-3 text-sm text-primary-700 text-center border border-primary-300 whitespace-nowrap"
              >
                {{ value }}
              </td>
              }
            </tr>
            } @empty {
            <tr>
              <td class="px-6 py-3 text-center text-primary-600">
                No results to display
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      } @if (headers().length === 0) {
      <div
        class="text-center text-primary-600 py-8 flex-1 flex items-center justify-center"
      >
        Enter an expression and click a button to see results
      </div>
      }
    </div>
  </div>
</div>
